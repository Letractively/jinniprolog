:-[gui_agent].

slowness(200). % time between steps in ms

maxsteps(10).

% try also new_console instead of new_ide

vivo_agent(Goal,Port):-vivo_agent(Port,Goal,Port). 

vivo_agent(WinName,Goal,Port):-
  server_port<=Port,
  finished<=no,
  gui_agent(new_console,WinName,Port,Goal). 

vivo_wait:-sleep(200000),halt.

vivo_stop:-
  finished<=yes,
  agent_stop,
  bg(and(sleep(1),halt)).
  
event_source:-
  server_port=>From,
  println(starting_source(From)),
  sleep(3),
  maxsteps(Max),
  slowness(MS),
  for(I,1,Max),
    sleep_ms(MS),
    println(sent=event(I)),
    fg(rli_out(agent2,event(to_2,I))),
    fg(rli_out(agent3,event(to_3,I))),
  fail.

fg(Goal):-Goal.
  
event_target:-
  server_port=>To,
  println(starting_target(To)),
  sleep(1),
  maxsteps(Max),
  for(_,1,Max),
    fg(
     and(
      rli_in(To,Mes),
      println(received=Mes),
      nl
     )
    ),
  fail.

